{% extends "base.html" %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="card mb-4 border-success">
    <div class="card-header bg-success text-white fw-bold">
        ğŸ’° ä»Šæ—¥ã®å¸‚æ³ã‚³ãƒ¡ãƒ³ãƒˆ
    </div>
    <div class="card-body">
        <p class="card-text">{{ summary | replace('\n', '<br>') | safe }}</p>
    </div>
</div>

<div class="row">
    {% for key, item in data.items() %}
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span class="fw-bold">{{ item.name }}</span>
                <span class="badge {% if '+' in item.diff %}bg-danger{% else %}bg-secondary{% endif %}">
                    {{ item.current }} ({{ item.diff }})
                </span>
            </div>
            <div class="card-body">
                <canvas id="chart-{{ key }}"></canvas>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<script>
    // Pythonã‹ã‚‰æ¸¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’JavaScriptã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
    const marketData = {{ data | tojson }};

    // ã™ã¹ã¦ã®éŠ˜æŸ„ã«ã¤ã„ã¦ãƒ«ãƒ¼ãƒ—ã—ã¦ã‚°ãƒ©ãƒ•ã‚’æã
    for (const [key, item] of Object.entries(marketData)) {
        const ctx = document.getElementById('chart-' + key).getContext('2d');
        
        // ç·šã®è‰²ï¼ˆä¸Šæ˜‡ãªã‚‰èµ¤ã€ä¸‹è½ãªã‚‰é’ï¼‰
        const lineColor = item.color === 'red' ? 'rgba(255, 99, 132, 1)' : 'rgba(54, 162, 235, 1)';
        const bgColor = item.color === 'red' ? 'rgba(255, 99, 132, 0.1)' : 'rgba(54, 162, 235, 0.1)';

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: item.dates, // æ¨ªè»¸ï¼ˆæ—¥ä»˜ï¼‰
                datasets: [{
                    label: item.name,
                    data: item.prices, // ç¸¦è»¸ï¼ˆä¾¡æ ¼ï¼‰
                    borderColor: lineColor,
                    backgroundColor: bgColor,
                    borderWidth: 2,
                    pointRadius: 1,
                    fill: true, // ä¸‹å´ã‚’å¡—ã‚Šã¤ã¶ã™
                    tension: 0.3 // æ›²ç·šã‚’ãªã‚ã‚‰ã‹ã«
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false } // å‡¡ä¾‹ã¯æ¶ˆã™
                },
                scales: {
                    x: { display: true }, // æ¨ªè»¸è¡¨ç¤º
                    y: { 
                        display: true,
                        beginAtZero: false // 0ã‹ã‚‰ã§ã¯ãªãã€ä¾¡æ ¼ã®ç¯„å›²ã«åˆã‚ã›ã¦æ‹¡å¤§
                    }
                }
            }
        });
    }
</script>
{% endblock %}
